[gd_scene load_steps=9 format=3 uid="uid://db3w5lvlmuq3o"]

[ext_resource type="Texture2D" uid="uid://c3igjs4qttd07" path="res://assets/salon_background.jpg" id="1_pxv7r"]
[ext_resource type="PackedScene" uid="uid://bvfhagtxo8wnp" path="res://scenes/customer.tscn" id="2_ydia2"]
[ext_resource type="Texture2D" uid="uid://doepp2q5n04te" path="res://assets/hair/chair.png" id="3_4np1q"]
[ext_resource type="Texture2D" uid="uid://dh1ju1g1apsrj" path="res://assets/speech_bubble_tail.png" id="5_ipbbk"]
[ext_resource type="Texture2D" uid="uid://8bl12luwgj06" path="res://assets/speech_bubble.png" id="6_022b8"]
[ext_resource type="Texture2D" uid="uid://bp4ax364pq8eg" path="res://assets/mirror.png" id="7_ff0pr"]
[ext_resource type="FontFile" uid="uid://dt2ur755qe8v6" path="res://assets/Nunito-Bold.ttf" id="7_v6u4s"]

[sub_resource type="GDScript" id="GDScript_ofgc3"]
script/source = "extends Node2D

@onready var speech_bubble = $\"Speech Bubble\"
@onready var label = $\"Speech Bubble/Label\"
@onready var mirror = $Mirror
@onready var customer = $Customer
@onready var chair = $Chair

enum DialogueState { AWAITING_MIRROR, REACTION }
var state = DialogueState.AWAITING_MIRROR

# Fade Transitions
func fade_in(node, duration := 0.4):
	if not node: return
	node.visible = true
	node.modulate.a = 0.0
	create_tween().tween_property(node, \"modulate:a\", 1.0, duration)

func fade_out(node, duration := 0.4):
	if not node: return
	var t = create_tween()
	t.tween_property(node, \"modulate:a\", 0.0, duration)
	t.finished.connect(func(): node.visible = false)

func _ready():
	if speech_bubble:
		speech_bubble.visible = false
	if mirror:
		mirror.visible = false
	
	label.text = \"I can't wait to see how I look! I'm sure you did stellar!\"
	fade_in(speech_bubble)

# Input
func _unhandled_input(event):
	if event is InputEventMouseButton and event.pressed:
		await advance_state()

func advance_state():
	fade_out(speech_bubble)
	await get_tree().create_timer(0.35).timeout

	# Fade in mirror 
	fade_in(mirror)
	evaluate_outfit()
	await get_tree().create_timer(1.0).timeout

	# Fade out mirror
	fade_out(mirror)
	await get_tree().create_timer(0.35).timeout

	# Go to results scene
	get_tree().change_scene_to_file(\"res://scenes/results.tscn\")

func evaluate_outfit():
	Gamestate.score = calculate_score()

func calculate_score() -> int:
	var score := 80  # Base score

	if Gamestate.selections.get(\"Lips\") == \"res://assets/lips/lips3.png\":
		score -= 40
	if Gamestate.selections.get(\"Shirt\") == \"res://assets/shirt/shirt1.png\":
		score -= 10
	if Gamestate.selections.get(\"Shirt\") == \"res://assets/shirt/shirt2.png\":
		score -= 30
	if Gamestate.selections.get(\"Shirt\") == \"res://assets/shirt/shirt3.png\":
		score += 20
	if Gamestate.selections.get(\"Shirt\") == \"res://assets/shirt/shirt3.png\":
		score += 40

	return clamp(score, 0, 100)

"

[node name="calculation" type="Node2D"]
script = SubResource("GDScript_ofgc3")

[node name="Camera2D" type="Camera2D" parent="."]

[node name="Background" type="Sprite2D" parent="."]
z_index = -20
position = Vector2(-0.161209, -0.278332)
scale = Vector2(0.301614, 0.301614)
texture = ExtResource("1_pxv7r")

[node name="Customer" parent="." instance=ExtResource("2_ydia2")]
position = Vector2(-205, 104)
scale = Vector2(0.25, 0.25)

[node name="Chair" type="Sprite2D" parent="."]
z_index = -10
position = Vector2(-193.25, 58.25)
scale = Vector2(0.298096, 0.298096)
texture = ExtResource("3_4np1q")

[node name="Speech Bubble" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_left = 103.545
offset_top = 24.0
offset_right = 103.545
offset_bottom = 24.0
scale = Vector2(1.0465, 1.12069)

[node name="SpeechBubbleTail" type="Sprite2D" parent="Speech Bubble"]
z_index = 1
position = Vector2(0, 28.5538)
texture = ExtResource("5_ipbbk")

[node name="Bubble" type="NinePatchRect" parent="Speech Bubble"]
layout_mode = 0
offset_left = -69.3215
offset_top = -206.123
offset_right = 371.678
offset_bottom = 24.8769
texture = ExtResource("6_022b8")
patch_margin_left = 40
patch_margin_top = 40
patch_margin_right = 40
patch_margin_bottom = 61

[node name="Label" type="Label" parent="Speech Bubble"]
z_index = 3
layout_mode = 0
offset_left = -28.0
offset_top = -170.0
offset_right = 332.0
offset_bottom = -22.0
theme_override_colors/font_color = Color(0.957031, 0.492188, 0.539063, 1)
theme_override_fonts/font = ExtResource("7_v6u4s")
theme_override_font_sizes/font_size = 30
horizontal_alignment = 1
vertical_alignment = 1
autowrap_mode = 3

[node name="Mirror" type="Sprite2D" parent="."]
z_index = 10
position = Vector2(-203, 215)
scale = Vector2(0.722672, 0.722672)
texture = ExtResource("7_ff0pr")
